\documentclass[BCOR=15mm, DIV=8]{scrbook}
\usepackage{typearea}

\KOMAoptions{
    captions=tableheading,
    captions=outerbeside,
    headings=twolinechapter,
    chapterprefix=true,
    numbers=noenddot
    % headsepline
}

% allow using UTF-8 characters in input
\usepackage[utf8]{inputenc}

\usepackage[german, english]{babel}

\usepackage{cool}

\usepackage{kpfonts}

% font encoding most suitable for european languages
\usepackage[T1]{fontenc}

% math
\usepackage{amsmath}
\usepackage{amsthm}
\usepackage{thmtools}
\usepackage{thm-restate}
\usepackage{mathtools}
\mathtoolsset{showonlyrefs=false}
\usepackage{bm}
\usepackage{xfrac}
\usepackage[binary-units=true]{siunitx}
\usepackage[version=3]{mhchem}

% typesetting
\usepackage{microtype}
\usepackage{booktabs}
\usepackage{tabularx,tabulary}
\usepackage[autostyle]{csquotes}
\usepackage[super]{nth}

\usepackage{enumitem}
\setlist{
    topsep=1ex,
    parsep=0pt,
    listparindent=\parindent}

\usepackage[nolist
            ]{acronym}

\usepackage{type1cm}
\usepackage{lettrine}

% bibliography
\usepackage[
    backend=biber,
    style=numeric-comp,
    sorting=none,
    doi=false,
    url=false,
    isbn=false,
    maxbibnames=99,
    giveninits=true,
    backref=true
]{biblatex}

% graphics
\usepackage{tikz}
\usetikzlibrary{
    decorations.pathreplacing,
    shapes.misc,
    shadings,
    arrows,
    calc,
    3d,
    positioning,
    matrix}
\tikzset{>=latex}

\usepackage{pgfplots}
\usepackage{pgfplotstable}
\pgfplotsset{compat = newest}
\usepgfplotslibrary{statistics}

\usepgfplotslibrary{external}
\tikzexternalize[prefix=tikz/]

\usepackage{tikzpagenodes}

\usepackage{import} % used by exported graphics from inkscape

\usepackage{etoolbox}
\usepackage{calc}
\usepackage[lofdepth, lotdepth]{subfig}

% miscellaneous
\usepackage[
    textsize=small
    ]{todonotes}

\definecolor{mycolor1}{HTML}{377EB8}% blue
\definecolor{mycolor2}{HTML}{FF7F00}% orange
\definecolor{mycolor3}{HTML}{4DAF4a}% green
\definecolor{mycolor4}{HTML}{E41A1C}% red
\definecolor{mycolor5}{HTML}{984EA3}% purple
\definecolor{accentcolor}{named}{gray}

\usepackage{hyperref}

\hypersetup{
    colorlinks,
    linkcolor={mycolor4!70!black},
    citecolor={mycolor1!70!black},
    urlcolor={mycolor1!70!black},
    pdftitle={PhD Thesis},
    pdfauthor={Timo Oster},
    bookmarksnumbered
}

\usepackage[capitalize, noabbrev]{cleveref}


% disable tikz externalization for todonotes
\newcommand{\MissingFigure}[2][]{\tikzexternaldisable\missingfigure[#1]{#2}\tikzexternalenable}
\newcommand{\ruggedtodo}[2][]{\tikzexternaldisable\todo[#1]{#2}\tikzexternalenable}
\newcommand{\Todo}[2][]{\ruggedtodo[color=mycolor2, bordercolor=mycolor2, #1]{#2}}
\newcommand{\Error}[2][]{\ruggedtodo[color=mycolor4, bordercolor=mycolor4, #1]{#2}}
\newcommand{\Suggestion}[2][]{\ruggedtodo[color=mycolor3!50, bordercolor=mycolor3!50, #1]{#2}}
\newcommand{\ToCite}[2][]{\ruggedtodo[color=mycolor5!50, bordercolor=mycolor5!50, #1]{#2}}


% turn off old-style figures where they don't belong
\newcommand\switchtoTLF{\fontfamily{jkp}\selectfont}
\newcommand\switchtoPLF{\fontfamily{jkp}\selectfont}
\newcommand\switchtoTOsF{\fontfamily{jkposn}\selectfont}
\newcommand\switchtoPOsF{\fontfamily{jkposn}\selectfont}
\newcommand\switchtoSLF{\fontfamily{jkpss}\selectfont}
\newcommand\switchtoSOsF{\fontfamily{jkpssosn}\selectfont}

\renewcommand{\acsfont}[1]{{\otherscshape{\MakeLowercase{#1}}}} % acronyms


% format parts
% ============
\renewcommand*{\partpagestyle}{empty}
\addtokomafont{part}{\normalfont\otherscshape\LARGE}

\renewcommand*{\partformat}{%
\centering
\scshape\fontsize{6cm}{6cm}\selectfont\textcolor{white!70!gray}{\thepart}

\vspace*{0.5cm}}
% \renewcommand*{\partformat}{
% \tikzset{external/export=false}%
% \begin{tikzpicture}[remember picture, overlay]
%     \node[anchor=center, inner sep=0, outer sep=0, yshift=1.5cm, xshift=2mm]
%         at (current page text area.center) {
%         \scshape\fontsize{10cm}{10cm}\selectfont\textcolor{white!70!gray}{\thepart}
%     };
% \end{tikzpicture}%
% \tikzset{external/export=true}%
% }

% format chapters
% ===============
% \let\raggedchapter\relax
\addtokomafont{chapter}{\otherscshape\LARGE}

\def\chaptercolor{accentcolor}

\renewcommand*{\chapterformat}{%
\vspace*{6cm}%
% \switchtoPLF{}\textcolor{\chaptercolor}{%
% \hspace*{\fill}%
% \fontsize{0.8cm}{0.8cm}\selectfont\scshape%
% \MakeLowercase{\chapappifchapterprefix{\nobreakspace}}%
% % \fontsize{5cm}{5cm}\selectfont\switchtoPLF{}\textcolor{\chaptercolor}{\thechapter}}%
% \fontsize{9cm}{9cm}\selectfont\textcolor{\chaptercolor}{\thechapter}}%
%
% \tikzset{external/export=false}%
% \begin{tikzpicture}[remember picture, overlay]
%     \node[anchor=north east, inner sep=0, outer sep=0, yshift=-3cm]
%         at (current page text area.north east) {
%         \fontsize{12cm}{12cm}\selectfont\textcolor{white!70!gray}{\thechapter}
%     };
% \end{tikzpicture}%
% \tikzset{external/export=true}%
%
\tikzset{external/export=false}%
\begin{tikzpicture}[remember picture, overlay]
    \node[anchor=south east, xshift=\textwidth+5mm, inner sep=0, outer sep=0]{
        \fontsize{10cm}{10cm}\selectfont\textcolor{white!70!gray}{\thechapter}
    };
\end{tikzpicture}%
\tikzset{external/export=true}%
}

% format sections
% ===============
\addtokomafont{disposition}{\rmfamily}

% Section numbers in margin
\renewcommand*{\sectionlinesformat}[4]{%
  \makebox[0pt][r]{#3}#4%
}
\renewcommand*{\sectionformat}{%
\textcolor{accentcolor}{\thesection\autodot\enskip}}

\renewcommand*{\subsectionformat}{%
\textcolor{accentcolor}{\thesubsection\autodot\enskip}}

% Page header
% \addtokomafont{pagehead}{\otherscshape}

% \AtBeginEnvironment{captionbeside}{\setcapindent{0em}}
\setcapindent{0em}
\addtokomafont{caption}{\small}
\addtokomafont{captionlabel}{\small\bfseries}

\tikzstyle{
    paperheader}=[anchor=north west,
                  at={(current page text area.north west)},
                  align=left,
                  text width=\textwidth,
                  color=gray,
                  inner sep=0,
                  outer sep=0]


\acused{1D}
\acused{2D}
\acused{3D}
\acused{4D}
\acused{5D}
\acused{6D}
\acused{CPU}

% commands and definitions
% ========================

% used in tikz figures to enable scaling
\newlength{\figurewidth}
\newlength{\figureheight}

\declaretheorem{theorem}


\input{macros}              % math macros

\input{acronyms}

\addbibresource{bib_master.bib}

\title{ Dissertation }
\subtitle{ New Visualization Techniques for Engineering Simulations }

\author{ Timo Oster }

\begin{document}
% \layout

\frontmatter

\maketitle

\cleardoublepage
\pdfbookmark{\contentsname}{toc}
\tableofcontents

\mainmatter

\input{sections/introduction}

\part{Background} % (fold)
\label{part:background}

\input{sections/sci_vis}

\input{sections/turbulent_combustion}

% part background (end)

\part%[Analysis and Visualization of Turbulent Combustion Simulations]
        {Analysis and Visualization of the Flame Front
         in Turbulent Combustion Simulations} % (fold)
\label{part:flame_vis}

\chapter[Sparse Representation for Turbulent Premixed Flames]
        {Sparse Representation and Visualization for Turbulent Premixed Flames} % (fold)
\label{cha:sparse_representation}
%
% \tikzset{external/export=false}
% \begin{tikzpicture}[remember picture, overlay]
%     \node[paperheader] (banner_fst) {
%             This chapter is based on\\
%             \fullcite{Oster2014}
%     };
% \end{tikzpicture}
% \tikzset{external/export=true}
%
\input{sections/sparse_representation/introduction}
\input{sections/sparse_representation/related}
\input{sections/sparse_representation/approach_compression}
\input{sections/sparse_representation/evaluation_compression}
\input{sections/sparse_representation/approach_visualization}
\input{sections/sparse_representation/evaluation_visualization}
\input{sections/sparse_representation/conclusion}
%
% chapter sparse_representation (end)

\chapter{In-Situ Tracking of the Flame Surface} % (fold)
\label{cha:flame_surface_tracking}
%
% \tikzset{external/export=false}
% \begin{tikzpicture}[remember picture, overlay]
%     \node[paperheader] (banner_fst) {
%             This chapter is based on\\
%             \fullcite{Oster2018a}
%     };
% \end{tikzpicture}
% \tikzset{external/export=true}
%
\input{sections/flame_surface_tracking/introduction}
\input{sections/flame_surface_tracking/related_work}
\input{sections/flame_surface_tracking/method}
\input{sections/flame_surface_tracking/implementation}
\input{sections/flame_surface_tracking/results}
\input{sections/flame_surface_tracking/discussion}
%
% chapter flame_surface_tracking (end)

\chapter{Conclusions} % (fold)
\label{cha:flame_vis_conclusions}

% chapter flame_vis_conclusions (end)

% part flame_vis (end)

\part{Line Features in 3D Second-Order Tensor Fields} % (fold)
\label{part:tensor_vis}

\chapter{The Parallel Eigenvectors Operator} % (fold)
\label{cha:parallel_eigenvectors}
%
% \tikzset{external/export=false}
% \begin{tikzpicture}[remember picture, overlay]
%     \node[paperheader] (banner_fst) {
%             This chapter is based on\\
%             \fullcite{Oster2018b}
%     };
% \end{tikzpicture}
% \tikzset{external/export=true}
%
\input{sections/parallel_eigenvectors/introduction}
\input{sections/parallel_eigenvectors/related_work}
\input{sections/parallel_eigenvectors/theory}
\input{sections/parallel_eigenvectors/method}
\input{sections/parallel_eigenvectors/results}
\input{sections/parallel_eigenvectors/discussion}
\input{sections/parallel_eigenvectors/limitations}
%
% chapter parallel_eigenvectors (end)

\chapter{Core Lines in 3D Second-Order Tensor Fields} % (fold)
\label{cha:tensor_core_lines}
%
% \tikzset{external/export=false}
% \begin{tikzpicture}[remember picture, overlay]
%     \node[paperheader] (banner_fst) {
%             This chapter is based on\\
%             \fullcite{Oster2018}
%     };
% \end{tikzpicture}
% \tikzset{external/export=true}
%
\input{sections/tensor_core_lines/introduction_holger}
\input{sections/tensor_core_lines/related_work}
\input{sections/tensor_core_lines/notation}
\input{sections/tensor_core_lines/theory}
\input{sections/tensor_core_lines/method_christian}
\input{sections/tensor_core_lines/results}
\Todo[inline]{Add section explaining how to compute PEV and degenerate lines
with the same algorithm}
\input{sections/tensor_core_lines/discussion}
%
% chapter tensor_core_lines (end)

\chapter{Conclusions} % (fold)
\label{cha:tensor_vis_conclusions}

% chapter tensor_vis_conclusions (end)

% part tensor_vis (end)
\part{Appendix}
\label{part:appendix}

\appendix
\input{sections/flame_surface_tracking/transform_interpolation}
\input{sections/parallel_eigenvectors/AdditionalMaterial}

\backmatter

\printbibliography[heading=bibintoc]

\end{document}